'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

const NUMERIC = "numeric";
const LONG = "long";
const SHORT = "short";
const TWODIGIT = "2-digit";
const FULL = "full";
class DateTimeFormat$1 {
    constructor(locale, options, pattern) {
        this.locale = locale;
        this.options = options;
        this.pattern = pattern;
        this.dateTimeFormatElements = {
            "M": "month",
            "E": "weekday",
            "c": "weekday",
            "d": "day",
            "y": "year",
            "h": "hour",
            "H": "hour",
            "m": "minute",
            "s": "second",
            "z": "timeZoneName",
            "G": "era",
            "a": "hour12"
        };
        if (options && options.minute === NUMERIC) {
            this.options.minute = TWODIGIT;
        }
        if (options && options.hour === NUMERIC) {
            this.options.hour = TWODIGIT;
        }
    }
    hasTimeOptions(options) {
        return options.hour !== undefined || options.minute !== undefined || options.second !== undefined;
    }
    hasDateOptions(options) {
        return options.weekday !== undefined ||
            options.year !== undefined ||
            options.month !== undefined ||
            options.day !== undefined;
    }
    useFullDatePattern(intlOptions) {
        let i;
        let propsArray = Object.keys(intlOptions);
        let propsArrayLength = propsArray.length;
        let result = false;
        for (i = 0; i < propsArrayLength; i++) {
            if (intlOptions[propsArray[i]] === LONG || intlOptions[propsArray[i]] === SHORT) {
                result = true;
                break;
            }
        }
        return result;
    }
    getNativePattern(patternDefinition, locale) {
        return "";
    }
    getCorrectPatternForLocale() {
        let dateTimePatternOptions = {};
        if (this.hasDateOptions(this.options)) {
            if (this.useFullDatePattern(this.options)) {
                dateTimePatternOptions.date = FULL;
            }
            else {
                dateTimePatternOptions.date = SHORT;
            }
        }
        if (this.hasTimeOptions(this.options)) {
            dateTimePatternOptions.time = FULL;
        }
        let result = this.getNativePattern(dateTimePatternOptions, this.locale);
        if (this.options.hour) {
            if (this.options.hour12 !== undefined) {
                result = this.options.hour12 ? result.replace(/H/g, "h") : result.replace(/h/g, "H");
            }
            else {
                this.options.hour12 = !(result.indexOf("H") > -1);
            }
        }
        return result;
    }
    getDateElementsFromPattern(pattern) {
        let result = [];
        let patternLength = pattern.length;
        let i = 0;
        let stringInsidePattern = false;
        while (i < patternLength) {
            if (pattern[i] === '"' || pattern[i] === "'") {
                let p = i + 1;
                while (p < patternLength && pattern[i] !== pattern[p]) {
                    p++;
                }
                for (let j = i; j < p + 1; j++) {
                    result.push({
                        "isDateElement": false,
                        "patternValue": pattern[j]
                    });
                }
                i = p + 1;
                continue;
            }
            if (this.dateTimeFormatElements.hasOwnProperty(pattern[i])) {
                let j = i;
                while (i < patternLength && pattern[i] === pattern[j]) {
                    i++;
                }
                result.push({
                    "isDateElement": true,
                    "patternValue": pattern.substr(j, i - j),
                    "intlOption": this.dateTimeFormatElements[pattern[j]]
                });
            }
            else {
                result.push({
                    "isDateElement": false,
                    "patternValue": pattern[i]
                });
                i++;
            }
        }
        return result;
    }
    prepareDateElement(intlOption, dateElement) {
        switch (intlOption) {
            case NUMERIC:
                return dateElement;
            case TWODIGIT:
                return dateElement.repeat(2);
            case SHORT:
                return dateElement.repeat(3);
            case LONG:
                return dateElement.repeat(4);
            case true:
                return dateElement;
            case false:
                return "";
            default:
                return dateElement;
        }
    }
    preparePattern(pattern, options) {
        let patternOptions = this.getDateElementsFromPattern(pattern);
        let patternOptionsLength = patternOptions.length;
        for (let i = 0; i < patternOptionsLength; i++) {
            if (patternOptions[i].isDateElement) {
                let formatChar = patternOptions[i].patternValue[0];
                let intlOptionValue = options[patternOptions[i].intlOption];
                if (intlOptionValue !== undefined) {
                    let newPatternValue = this.prepareDateElement(intlOptionValue, formatChar);
                    patternOptions[i].patternValue = newPatternValue;
                }
                else {
                    if (i > 0) {
                        let j = i - 1;
                        while (patternOptions[j] && patternOptions[j].isDateElement === false) {
                            if (patternOptions[j].patternValue !== " ") {
                                if (patternOptions[j].patternValue !== '"' && patternOptions[j].patternValue !== "'") {
                                    patternOptions[j].patternValue = "";
                                }
                                break;
                            }
                            else {
                                patternOptions[j].patternValue = "";
                            }
                            j--;
                        }
                    }
                    patternOptions[i].patternValue = "";
                }
            }
        }
        let result = [];
        let i = 0;
        while (patternOptions[i].patternValue === "" || patternOptions[i].isDateElement === false) {
            i++;
        }
        for (i; i < patternOptionsLength; i++) {
            result.push(patternOptions[i].patternValue);
        }
        return result.join("");
    }
    formatNative(pattern, locale, date) {
        return "";
    }
    get preparedPattern() {
        if (!this._preparedPattern) {
            if (this.pattern) {
                this._preparedPattern = this.pattern;
            }
            else {
                this._preparedPattern = this.preparePattern(this.getCorrectPatternForLocale(), this.options);
            }
        }
        return this._preparedPattern;
    }
    format(date) {
        return this.formatNative(this.preparedPattern, this.locale, date);
    }
}
class NumberFormat$1 {
    constructor(locale, options, pattern) {
        this.locale = locale;
        this.options = options;
        this.pattern = pattern;
    }
    formatNative(value, locale, options, pattern) {
        return "";
    }
    format(value) {
        return this.formatNative(value, this.locale, this.options, this.pattern);
    }
}

class DateTimeFormat$$1 extends DateTimeFormat$1 {
    getNativePattern(patternDefinition, locale) {
        let dateFormatter = NSDateFormatter.new();
        if (locale) {
            dateFormatter.locale = NSLocale.alloc().initWithLocaleIdentifier(locale);
        }
        if (patternDefinition.date) {
            dateFormatter.dateStyle = patternDefinition.date === FULL ?
                4 :
                1;
        }
        if (patternDefinition.time) {
            dateFormatter.timeStyle = 3;
        }
        return dateFormatter.dateFormat;
    }
    formatNative(pattern, locale, date) {
        let dateFormatter = NSDateFormatter.new();
        if (locale) {
            dateFormatter.locale = NSLocale.alloc().initWithLocaleIdentifier(locale);
        }
        dateFormatter.dateFormat = pattern;
        return dateFormatter.stringFromDate(date ? date : new Date());
    }
}
class NumberFormat$$1 extends NumberFormat$1 {
    formatNative(value, locale, options, pattern) {
        let numberFormat = NSNumberFormatter.new();
        if (locale) {
            numberFormat.locale = NSLocale.alloc().initWithLocaleIdentifier(locale);
        }
        if (options) {
            switch (options.style.toLowerCase()) {
                case "decimal":
                    numberFormat.numberStyle = 1;
                    break;
                case "percent":
                    numberFormat.numberStyle = 3;
                    break;
                case "currency":
                    numberFormat.numberStyle = 2;
                    if (options.currency !== void 0) {
                        numberFormat.currencyCode = options.currency;
                    }
                    break;
                default:
                    numberFormat.numberStyle = 1;
                    break;
            }
        }
        else {
            numberFormat.numberStyle = 1;
        }
        if (options && options.minimumIntegerDigits !== void 0) {
            numberFormat.minimumIntegerDigits = options.minimumIntegerDigits;
        }
        if (options && options.minimumFractionDigits !== void 0) {
            numberFormat.minimumFractionDigits = options.minimumFractionDigits;
        }
        if (options && options.maximumFractionDigits !== void 0) {
            numberFormat.maximumFractionDigits = options.maximumFractionDigits;
        }
        if (options && options.useGrouping !== void 0) {
            numberFormat.usesGroupingSeparator = options.useGrouping;
        }
        if (pattern) {
            numberFormat.positiveFormat = pattern;
        }
        else {
            if (options && (options.style.toLowerCase() === "currency" && options.currencyDisplay === "code")) {
                let tempPattern = numberFormat.positiveFormat;
                tempPattern = tempPattern.replace("¤", "¤¤");
                numberFormat.positiveFormat = tempPattern;
            }
        }
        return numberFormat.stringFromNumber(value);
    }
}

if (!global.Intl) {
    global.Intl = {};
}
global.Intl.DateTimeFormat = DateTimeFormat$$1;
global.Intl.NumberFormat = NumberFormat$$1;

exports.DateTimeFormat = DateTimeFormat$$1;
exports.NumberFormat = NumberFormat$$1;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmlvcy5qcyIsInNvdXJjZXMiOlsibmF0aXZlc2NyaXB0LWludGwtY29tbW9uLmpzIiwibmF0aXZlc2NyaXB0LWludGwuaW9zLmpzIiwiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IE5VTUVSSUMgPSBcIm51bWVyaWNcIjtcclxuZXhwb3J0IGNvbnN0IExPTkcgPSBcImxvbmdcIjtcclxuZXhwb3J0IGNvbnN0IFNIT1JUID0gXCJzaG9ydFwiO1xyXG5leHBvcnQgY29uc3QgVFdPRElHSVQgPSBcIjItZGlnaXRcIjtcclxuZXhwb3J0IGNvbnN0IEZVTEwgPSBcImZ1bGxcIjtcclxuZXhwb3J0IGNsYXNzIERhdGVUaW1lRm9ybWF0IHtcclxuICAgIGNvbnN0cnVjdG9yKGxvY2FsZSwgb3B0aW9ucywgcGF0dGVybikge1xyXG4gICAgICAgIHRoaXMubG9jYWxlID0gbG9jYWxlO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgdGhpcy5wYXR0ZXJuID0gcGF0dGVybjtcclxuICAgICAgICB0aGlzLmRhdGVUaW1lRm9ybWF0RWxlbWVudHMgPSB7XHJcbiAgICAgICAgICAgIFwiTVwiOiBcIm1vbnRoXCIsXHJcbiAgICAgICAgICAgIFwiRVwiOiBcIndlZWtkYXlcIixcclxuICAgICAgICAgICAgXCJjXCI6IFwid2Vla2RheVwiLFxyXG4gICAgICAgICAgICBcImRcIjogXCJkYXlcIixcclxuICAgICAgICAgICAgXCJ5XCI6IFwieWVhclwiLFxyXG4gICAgICAgICAgICBcImhcIjogXCJob3VyXCIsXHJcbiAgICAgICAgICAgIFwiSFwiOiBcImhvdXJcIixcclxuICAgICAgICAgICAgXCJtXCI6IFwibWludXRlXCIsXHJcbiAgICAgICAgICAgIFwic1wiOiBcInNlY29uZFwiLFxyXG4gICAgICAgICAgICBcInpcIjogXCJ0aW1lWm9uZU5hbWVcIixcclxuICAgICAgICAgICAgXCJHXCI6IFwiZXJhXCIsXHJcbiAgICAgICAgICAgIFwiYVwiOiBcImhvdXIxMlwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLm1pbnV0ZSA9PT0gTlVNRVJJQykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWludXRlID0gVFdPRElHSVQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaG91ciA9PT0gTlVNRVJJQykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuaG91ciA9IFRXT0RJR0lUO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGhhc1RpbWVPcHRpb25zKG9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gb3B0aW9ucy5ob3VyICE9PSB1bmRlZmluZWQgfHwgb3B0aW9ucy5taW51dGUgIT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLnNlY29uZCAhPT0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgaGFzRGF0ZU9wdGlvbnMob3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBvcHRpb25zLndlZWtkYXkgIT09IHVuZGVmaW5lZCB8fFxyXG4gICAgICAgICAgICBvcHRpb25zLnllYXIgIT09IHVuZGVmaW5lZCB8fFxyXG4gICAgICAgICAgICBvcHRpb25zLm1vbnRoICE9PSB1bmRlZmluZWQgfHxcclxuICAgICAgICAgICAgb3B0aW9ucy5kYXkgIT09IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIHVzZUZ1bGxEYXRlUGF0dGVybihpbnRsT3B0aW9ucykge1xyXG4gICAgICAgIGxldCBpO1xyXG4gICAgICAgIGxldCBwcm9wc0FycmF5ID0gT2JqZWN0LmtleXMoaW50bE9wdGlvbnMpO1xyXG4gICAgICAgIGxldCBwcm9wc0FycmF5TGVuZ3RoID0gcHJvcHNBcnJheS5sZW5ndGg7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBwcm9wc0FycmF5TGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGludGxPcHRpb25zW3Byb3BzQXJyYXlbaV1dID09PSBMT05HIHx8IGludGxPcHRpb25zW3Byb3BzQXJyYXlbaV1dID09PSBTSE9SVCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICBnZXROYXRpdmVQYXR0ZXJuKHBhdHRlcm5EZWZpbml0aW9uLCBsb2NhbGUpIHtcclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH1cclxuICAgIGdldENvcnJlY3RQYXR0ZXJuRm9yTG9jYWxlKCkge1xyXG4gICAgICAgIGxldCBkYXRlVGltZVBhdHRlcm5PcHRpb25zID0ge307XHJcbiAgICAgICAgaWYgKHRoaXMuaGFzRGF0ZU9wdGlvbnModGhpcy5vcHRpb25zKSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy51c2VGdWxsRGF0ZVBhdHRlcm4odGhpcy5vcHRpb25zKSkge1xyXG4gICAgICAgICAgICAgICAgZGF0ZVRpbWVQYXR0ZXJuT3B0aW9ucy5kYXRlID0gRlVMTDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRhdGVUaW1lUGF0dGVybk9wdGlvbnMuZGF0ZSA9IFNIT1JUO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmhhc1RpbWVPcHRpb25zKHRoaXMub3B0aW9ucykpIHtcclxuICAgICAgICAgICAgZGF0ZVRpbWVQYXR0ZXJuT3B0aW9ucy50aW1lID0gRlVMTDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuZ2V0TmF0aXZlUGF0dGVybihkYXRlVGltZVBhdHRlcm5PcHRpb25zLCB0aGlzLmxvY2FsZSk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5ob3VyKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaG91cjEyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMub3B0aW9ucy5ob3VyMTIgPyByZXN1bHQucmVwbGFjZSgvSC9nLCBcImhcIikgOiByZXN1bHQucmVwbGFjZSgvaC9nLCBcIkhcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuaG91cjEyID0gIShyZXN1bHQuaW5kZXhPZihcIkhcIikgPiAtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIGdldERhdGVFbGVtZW50c0Zyb21QYXR0ZXJuKHBhdHRlcm4pIHtcclxuICAgICAgICBsZXQgcmVzdWx0ID0gW107XHJcbiAgICAgICAgbGV0IHBhdHRlcm5MZW5ndGggPSBwYXR0ZXJuLmxlbmd0aDtcclxuICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgbGV0IHN0cmluZ0luc2lkZVBhdHRlcm4gPSBmYWxzZTtcclxuICAgICAgICB3aGlsZSAoaSA8IHBhdHRlcm5MZW5ndGgpIHtcclxuICAgICAgICAgICAgaWYgKHBhdHRlcm5baV0gPT09ICdcIicgfHwgcGF0dGVybltpXSA9PT0gXCInXCIpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwID0gaSArIDE7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAocCA8IHBhdHRlcm5MZW5ndGggJiYgcGF0dGVybltpXSAhPT0gcGF0dGVybltwXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHArKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSBpOyBqIDwgcCArIDE7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpc0RhdGVFbGVtZW50XCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBhdHRlcm5WYWx1ZVwiOiBwYXR0ZXJuW2pdXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpID0gcCArIDE7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRlVGltZUZvcm1hdEVsZW1lbnRzLmhhc093blByb3BlcnR5KHBhdHRlcm5baV0pKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaiA9IGk7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IHBhdHRlcm5MZW5ndGggJiYgcGF0dGVybltpXSA9PT0gcGF0dGVybltqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBcImlzRGF0ZUVsZW1lbnRcIjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBcInBhdHRlcm5WYWx1ZVwiOiBwYXR0ZXJuLnN1YnN0cihqLCBpIC0gaiksXHJcbiAgICAgICAgICAgICAgICAgICAgXCJpbnRsT3B0aW9uXCI6IHRoaXMuZGF0ZVRpbWVGb3JtYXRFbGVtZW50c1twYXR0ZXJuW2pdXVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJpc0RhdGVFbGVtZW50XCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIFwicGF0dGVyblZhbHVlXCI6IHBhdHRlcm5baV1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICBwcmVwYXJlRGF0ZUVsZW1lbnQoaW50bE9wdGlvbiwgZGF0ZUVsZW1lbnQpIHtcclxuICAgICAgICBzd2l0Y2ggKGludGxPcHRpb24pIHtcclxuICAgICAgICAgICAgY2FzZSBOVU1FUklDOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVFbGVtZW50O1xyXG4gICAgICAgICAgICBjYXNlIFRXT0RJR0lUOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVFbGVtZW50LnJlcGVhdCgyKTtcclxuICAgICAgICAgICAgY2FzZSBTSE9SVDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRlRWxlbWVudC5yZXBlYXQoMyk7XHJcbiAgICAgICAgICAgIGNhc2UgTE9ORzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRlRWxlbWVudC5yZXBlYXQoNCk7XHJcbiAgICAgICAgICAgIGNhc2UgdHJ1ZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRlRWxlbWVudDtcclxuICAgICAgICAgICAgY2FzZSBmYWxzZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByZXBhcmVQYXR0ZXJuKHBhdHRlcm4sIG9wdGlvbnMpIHtcclxuICAgICAgICBsZXQgcGF0dGVybk9wdGlvbnMgPSB0aGlzLmdldERhdGVFbGVtZW50c0Zyb21QYXR0ZXJuKHBhdHRlcm4pO1xyXG4gICAgICAgIGxldCBwYXR0ZXJuT3B0aW9uc0xlbmd0aCA9IHBhdHRlcm5PcHRpb25zLmxlbmd0aDtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhdHRlcm5PcHRpb25zTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHBhdHRlcm5PcHRpb25zW2ldLmlzRGF0ZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGxldCBmb3JtYXRDaGFyID0gcGF0dGVybk9wdGlvbnNbaV0ucGF0dGVyblZhbHVlWzBdO1xyXG4gICAgICAgICAgICAgICAgbGV0IGludGxPcHRpb25WYWx1ZSA9IG9wdGlvbnNbcGF0dGVybk9wdGlvbnNbaV0uaW50bE9wdGlvbl07XHJcbiAgICAgICAgICAgICAgICBpZiAoaW50bE9wdGlvblZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbmV3UGF0dGVyblZhbHVlID0gdGhpcy5wcmVwYXJlRGF0ZUVsZW1lbnQoaW50bE9wdGlvblZhbHVlLCBmb3JtYXRDaGFyKTtcclxuICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuT3B0aW9uc1tpXS5wYXR0ZXJuVmFsdWUgPSBuZXdQYXR0ZXJuVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGogPSBpIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHBhdHRlcm5PcHRpb25zW2pdICYmIHBhdHRlcm5PcHRpb25zW2pdLmlzRGF0ZUVsZW1lbnQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF0dGVybk9wdGlvbnNbal0ucGF0dGVyblZhbHVlICE9PSBcIiBcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuT3B0aW9uc1tqXS5wYXR0ZXJuVmFsdWUgIT09ICdcIicgJiYgcGF0dGVybk9wdGlvbnNbal0ucGF0dGVyblZhbHVlICE9PSBcIidcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuT3B0aW9uc1tqXS5wYXR0ZXJuVmFsdWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm5PcHRpb25zW2pdLnBhdHRlcm5WYWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk9wdGlvbnNbaV0ucGF0dGVyblZhbHVlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcmVzdWx0ID0gW107XHJcbiAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgIHdoaWxlIChwYXR0ZXJuT3B0aW9uc1tpXS5wYXR0ZXJuVmFsdWUgPT09IFwiXCIgfHwgcGF0dGVybk9wdGlvbnNbaV0uaXNEYXRlRWxlbWVudCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGk7IGkgPCBwYXR0ZXJuT3B0aW9uc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHBhdHRlcm5PcHRpb25zW2ldLnBhdHRlcm5WYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQuam9pbihcIlwiKTtcclxuICAgIH1cclxuICAgIGZvcm1hdE5hdGl2ZShwYXR0ZXJuLCBsb2NhbGUsIGRhdGUpIHtcclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH1cclxuICAgIGdldCBwcmVwYXJlZFBhdHRlcm4oKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9wcmVwYXJlZFBhdHRlcm4pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGF0dGVybikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZWRQYXR0ZXJuID0gdGhpcy5wYXR0ZXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZWRQYXR0ZXJuID0gdGhpcy5wcmVwYXJlUGF0dGVybih0aGlzLmdldENvcnJlY3RQYXR0ZXJuRm9yTG9jYWxlKCksIHRoaXMub3B0aW9ucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXBhcmVkUGF0dGVybjtcclxuICAgIH1cclxuICAgIGZvcm1hdChkYXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0TmF0aXZlKHRoaXMucHJlcGFyZWRQYXR0ZXJuLCB0aGlzLmxvY2FsZSwgZGF0ZSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIE51bWJlckZvcm1hdCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihsb2NhbGUsIG9wdGlvbnMsIHBhdHRlcm4pIHtcclxuICAgICAgICB0aGlzLmxvY2FsZSA9IGxvY2FsZTtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgICAgIHRoaXMucGF0dGVybiA9IHBhdHRlcm47XHJcbiAgICB9XHJcbiAgICBmb3JtYXROYXRpdmUodmFsdWUsIGxvY2FsZSwgb3B0aW9ucywgcGF0dGVybikge1xyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgfVxyXG4gICAgZm9ybWF0KHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0TmF0aXZlKHZhbHVlLCB0aGlzLmxvY2FsZSwgdGhpcy5vcHRpb25zLCB0aGlzLnBhdHRlcm4pO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IERhdGVUaW1lRm9ybWF0IGFzIGNvbW1vbkRhdGVUaW1lRm9ybWF0LCBOdW1iZXJGb3JtYXQgYXMgY29tbW9uTnVtYmVyRm9ybWF0LCBGVUxMIH0gZnJvbSBcIi4vbmF0aXZlc2NyaXB0LWludGwtY29tbW9uXCI7XHJcbmV4cG9ydCBjbGFzcyBEYXRlVGltZUZvcm1hdCBleHRlbmRzIGNvbW1vbkRhdGVUaW1lRm9ybWF0IHtcclxuICAgIGdldE5hdGl2ZVBhdHRlcm4ocGF0dGVybkRlZmluaXRpb24sIGxvY2FsZSkge1xyXG4gICAgICAgIGxldCBkYXRlRm9ybWF0dGVyID0gTlNEYXRlRm9ybWF0dGVyLm5ldygpO1xyXG4gICAgICAgIGlmIChsb2NhbGUpIHtcclxuICAgICAgICAgICAgZGF0ZUZvcm1hdHRlci5sb2NhbGUgPSBOU0xvY2FsZS5hbGxvYygpLmluaXRXaXRoTG9jYWxlSWRlbnRpZmllcihsb2NhbGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocGF0dGVybkRlZmluaXRpb24uZGF0ZSkge1xyXG4gICAgICAgICAgICBkYXRlRm9ybWF0dGVyLmRhdGVTdHlsZSA9IHBhdHRlcm5EZWZpbml0aW9uLmRhdGUgPT09IEZVTEwgP1xyXG4gICAgICAgICAgICAgICAgNCA6XHJcbiAgICAgICAgICAgICAgICAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocGF0dGVybkRlZmluaXRpb24udGltZSkge1xyXG4gICAgICAgICAgICBkYXRlRm9ybWF0dGVyLnRpbWVTdHlsZSA9IDM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRlRm9ybWF0dGVyLmRhdGVGb3JtYXQ7XHJcbiAgICB9XHJcbiAgICBmb3JtYXROYXRpdmUocGF0dGVybiwgbG9jYWxlLCBkYXRlKSB7XHJcbiAgICAgICAgbGV0IGRhdGVGb3JtYXR0ZXIgPSBOU0RhdGVGb3JtYXR0ZXIubmV3KCk7XHJcbiAgICAgICAgaWYgKGxvY2FsZSkge1xyXG4gICAgICAgICAgICBkYXRlRm9ybWF0dGVyLmxvY2FsZSA9IE5TTG9jYWxlLmFsbG9jKCkuaW5pdFdpdGhMb2NhbGVJZGVudGlmaWVyKGxvY2FsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRhdGVGb3JtYXR0ZXIuZGF0ZUZvcm1hdCA9IHBhdHRlcm47XHJcbiAgICAgICAgcmV0dXJuIGRhdGVGb3JtYXR0ZXIuc3RyaW5nRnJvbURhdGUoZGF0ZSA/IGRhdGUgOiBuZXcgRGF0ZSgpKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgTnVtYmVyRm9ybWF0IGV4dGVuZHMgY29tbW9uTnVtYmVyRm9ybWF0IHtcclxuICAgIGZvcm1hdE5hdGl2ZSh2YWx1ZSwgbG9jYWxlLCBvcHRpb25zLCBwYXR0ZXJuKSB7XHJcbiAgICAgICAgbGV0IG51bWJlckZvcm1hdCA9IE5TTnVtYmVyRm9ybWF0dGVyLm5ldygpO1xyXG4gICAgICAgIGlmIChsb2NhbGUpIHtcclxuICAgICAgICAgICAgbnVtYmVyRm9ybWF0LmxvY2FsZSA9IE5TTG9jYWxlLmFsbG9jKCkuaW5pdFdpdGhMb2NhbGVJZGVudGlmaWVyKGxvY2FsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5zdHlsZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGVjaW1hbFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlckZvcm1hdC5udW1iZXJTdHlsZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwicGVyY2VudFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlckZvcm1hdC5udW1iZXJTdHlsZSA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiY3VycmVuY3lcIjpcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXJGb3JtYXQubnVtYmVyU3R5bGUgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmN1cnJlbmN5ICE9PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyRm9ybWF0LmN1cnJlbmN5Q29kZSA9IG9wdGlvbnMuY3VycmVuY3k7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXJGb3JtYXQubnVtYmVyU3R5bGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBudW1iZXJGb3JtYXQubnVtYmVyU3R5bGUgPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLm1pbmltdW1JbnRlZ2VyRGlnaXRzICE9PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgbnVtYmVyRm9ybWF0Lm1pbmltdW1JbnRlZ2VyRGlnaXRzID0gb3B0aW9ucy5taW5pbXVtSW50ZWdlckRpZ2l0cztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5taW5pbXVtRnJhY3Rpb25EaWdpdHMgIT09IHZvaWQgMCkge1xyXG4gICAgICAgICAgICBudW1iZXJGb3JtYXQubWluaW11bUZyYWN0aW9uRGlnaXRzID0gb3B0aW9ucy5taW5pbXVtRnJhY3Rpb25EaWdpdHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMubWF4aW11bUZyYWN0aW9uRGlnaXRzICE9PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgbnVtYmVyRm9ybWF0Lm1heGltdW1GcmFjdGlvbkRpZ2l0cyA9IG9wdGlvbnMubWF4aW11bUZyYWN0aW9uRGlnaXRzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVzZUdyb3VwaW5nICE9PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgbnVtYmVyRm9ybWF0LnVzZXNHcm91cGluZ1NlcGFyYXRvciA9IG9wdGlvbnMudXNlR3JvdXBpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXR0ZXJuKSB7XHJcbiAgICAgICAgICAgIG51bWJlckZvcm1hdC5wb3NpdGl2ZUZvcm1hdCA9IHBhdHRlcm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAob3B0aW9ucyAmJiAob3B0aW9ucy5zdHlsZS50b0xvd2VyQ2FzZSgpID09PSBcImN1cnJlbmN5XCIgJiYgb3B0aW9ucy5jdXJyZW5jeURpc3BsYXkgPT09IFwiY29kZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHRlbXBQYXR0ZXJuID0gbnVtYmVyRm9ybWF0LnBvc2l0aXZlRm9ybWF0O1xyXG4gICAgICAgICAgICAgICAgdGVtcFBhdHRlcm4gPSB0ZW1wUGF0dGVybi5yZXBsYWNlKFwiwqRcIiwgXCLCpMKkXCIpO1xyXG4gICAgICAgICAgICAgICAgbnVtYmVyRm9ybWF0LnBvc2l0aXZlRm9ybWF0ID0gdGVtcFBhdHRlcm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bWJlckZvcm1hdC5zdHJpbmdGcm9tTnVtYmVyKHZhbHVlKTtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBEYXRlVGltZUZvcm1hdCwgTnVtYmVyRm9ybWF0IH0gZnJvbSBcIi4vbmF0aXZlc2NyaXB0LWludGxcIjtcclxuZXhwb3J0IHsgRGF0ZVRpbWVGb3JtYXQsIE51bWJlckZvcm1hdCB9IGZyb20gXCIuL25hdGl2ZXNjcmlwdC1pbnRsXCI7XHJcbmlmICghZ2xvYmFsLkludGwpIHtcclxuICAgIGdsb2JhbC5JbnRsID0ge307XHJcbn1cclxuZ2xvYmFsLkludGwuRGF0ZVRpbWVGb3JtYXQgPSBEYXRlVGltZUZvcm1hdDtcclxuZ2xvYmFsLkludGwuTnVtYmVyRm9ybWF0ID0gTnVtYmVyRm9ybWF0O1xyXG4iXSwibmFtZXMiOlsiRGF0ZVRpbWVGb3JtYXQiLCJOdW1iZXJGb3JtYXQiLCJjb21tb25EYXRlVGltZUZvcm1hdCIsImNvbW1vbk51bWJlckZvcm1hdCJdLCJtYXBwaW5ncyI6Ijs7OztBQUFPLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQztBQUNqQyxBQUFPLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQztBQUMzQixBQUFPLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQztBQUM3QixBQUFPLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQztBQUNsQyxBQUFPLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQztBQUMzQixBQUFPLE1BQU1BLGdCQUFjLENBQUM7SUFDeEIsV0FBVyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFO1FBQ2xDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxzQkFBc0IsR0FBRztZQUMxQixHQUFHLEVBQUUsT0FBTztZQUNaLEdBQUcsRUFBRSxTQUFTO1lBQ2QsR0FBRyxFQUFFLFNBQVM7WUFDZCxHQUFHLEVBQUUsS0FBSztZQUNWLEdBQUcsRUFBRSxNQUFNO1lBQ1gsR0FBRyxFQUFFLE1BQU07WUFDWCxHQUFHLEVBQUUsTUFBTTtZQUNYLEdBQUcsRUFBRSxRQUFRO1lBQ2IsR0FBRyxFQUFFLFFBQVE7WUFDYixHQUFHLEVBQUUsY0FBYztZQUNuQixHQUFHLEVBQUUsS0FB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
